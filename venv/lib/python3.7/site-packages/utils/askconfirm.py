from redbot.core import commands as cmd
from discord import Embed
from utils.imports import COLOR

async def ask_confirm(**kwargs):
    ctx = kwargs.pop('ctx', None)
    bot = kwargs.pop('bot', None)
    pic = kwargs.pop('pic', None)
    conf_mess = kwargs.pop('conf_mess', "No message set.")

    def check(m):
        if m.channel != ctx.channel or m.author != ctx.message.author:
            return False
        elif m.content.lower()[0] not in "yn":
            return False
        else:
            return True

    embed = Embed(
        title="Confirm?",
        color=COLOR,
        description=conf_mess
    )

    await ctx.send(file=pic, embed=embed)

    confirm = await bot.wait_for('message', check=check)

    return bool(confirm.content.lower().startswith("y"))

async def ask_reset(**kwargs):
    ctx = kwargs.pop('ctx')
    bot = kwargs.pop('bot')
    answer = await ask_confirm(
        bot=bot,
        ctx=ctx,
        conf_mess=kwargs.pop('message', "No message set.")
    )

    if answer:
        args = kwargs.pop('args', None)
        if args is None:
            await kwargs.pop('res_func')()
        else:
            await kwargs.pop('res_func')(args)
        embed = Embed(
            title="Reset.",
            color=COLOR,
            description="{} has been reset.".format(kwargs.pop('obj'))
        )
    else:
        embed = Embed(
            title="Cancelled",
            color=COLOR,
            description="Reset cancelled."
        )
    
    await ctx.send(embed=embed)